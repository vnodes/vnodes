generator client {
  provider               = "prisma-client"
  output                 = "../src"
  runtime                = "nodejs"
  importFileExtension    = "js"
  generatedFileExtension = "ts"
  moduleFormat           = "esm"
}

datasource db {
  provider = "postgresql"
}

enum Gender {
  Male
  Female
}

enum UserType {
  Employee
  Customer
  Partner
  Supplier
  Manufacturer
}

enum ContactType {
  Personal
  Work
}

model Department {
  id        Int       @id @default(autoincrement())
  uuid      String    @unique @default(uuid(7))
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  name String @unique

  contacts Contact[]
}

model Company {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  name String @unique

  contacts Contact[]
}

model Occupation {
  id        Int       @id @default(autoincrement())
  uuid      String    @unique @default(uuid(7))
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  name String @unique

  contacts Contact[]
}

model Contact {
  id        Int       @id @default(autoincrement())
  uuid      String    @unique @default(uuid(7))
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  firstName    String
  lastName     String
  middleName   String
  preferedName String?

  userType UserType

  gender Gender

  company   Company? @relation(fields: [companyId], references: [id])
  companyId Int?

  occupation   Occupation? @relation(fields: [occupationId], references: [id])
  occupationId Int?

  department   Department? @relation(fields: [departmentId], references: [id])
  departmentId Int?

  primaryEmail   Email? @relation("primary", fields: [primaryEmailId], references: [id], onDelete: SetNull)
  primaryEmailId Int?

  primaryPhone   Phone? @relation("primary", fields: [primaryPhoneId], references: [id], onDelete: SetNull)
  primaryPhoneId Int?

  primaryAddress   Address? @relation("primary", fields: [primaryAddressId], references: [id], onDelete: SetNull)
  primaryAddressId Int?

  emails    Email[]   @relation("owner")
  phones    Phone[]   @relation("owner")
  addresses Address[] @relation("owner")
}

model Email {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  email       String
  contactType ContactType @default(Personal)
  notes       String?

  contact   Contact @relation("owner", fields: [contactId], references: [id])
  contactId Int

  contacts Contact[] @relation("primary")

  @@unique([contactId, email])
  @@index([email])
  @@index([contactId])
}

model Phone {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  phone       String
  contactType ContactType @default(Personal)
  notes       String?

  contact   Contact @relation("owner", fields: [contactId], references: [id])
  contactId Int

  contacts Contact[] @relation("primary")

  @@unique([contactId, phone])
  @@index([phone])
  @@index([contactId])
}

model Address {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  street      String
  city        String
  contactType ContactType @default(Personal)
  notes       String?

  unit     String?
  province String?
  state    String?
  country  String?
  zip      String?

  contact   Contact @relation("owner", fields: [contactId], references: [id])
  contactId Int

  contacts Contact[] @relation("primary")

  @@index([contactId])
}
