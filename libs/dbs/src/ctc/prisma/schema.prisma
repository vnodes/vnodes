generator client {
  provider               = "prisma-client"
  output                 = "../src"
  runtime                = "nodejs"
  importFileExtension    = "js"
  generatedFileExtension = "ts"
  moduleFormat           = "esm"
}

datasource db {
  provider = "postgresql"
}

enum Gender {
  Male
  Female
}

enum ContactType {
  Customer
  Service
  Vendor
  Partner
  Supplier
  Manufacturer
  Competitor
}

enum PersonalOrWork {
  Personal
  Work
}

model Department {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  name String @unique

  contacts Contact[]
}

model Industry {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  name String @unique

  companies Company[]
}

model Company {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  industry   Industry? @relation(fields: [industryId], references: [id])
  industryId Int?
  name       String    @unique
  profiles   String[]
  openTime   Json?     @default("[]")

  contacts Contact[]
  taxInfo  TaxInfo?
}

model TaxInfo {
  id        Int      @id @default(autoincrement())
  updatedAt DateTime @updatedAt

  taxNumber     String  @unique // EIN, VAT, or Social Security
  taxCountry    String // The jurisdiction for this tax ID
  isTaxExempt   Boolean @default(false)
  exemptionNote String?

  company   Company? @relation(fields: [companyId], references: [id])
  companyId Int?     @unique

  contact   Contact? @relation(fields: [contactId], references: [id])
  contactId Int?     @unique
}

model Occupation {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  name String @unique

  contacts Contact[]
}

model Contact {
  id        Int       @id @default(autoincrement())
  uuid      String    @unique @default(uuid(7)) @db.Uuid
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  userType     ContactType
  firstName    String
  lastName     String
  middleName   String?
  preferedName String?
  gender       Gender?
  profiles     String[]

  company   Company? @relation(fields: [companyId], references: [id])
  companyId Int?

  occupation   Occupation? @relation(fields: [occupationId], references: [id])
  occupationId Int?

  department   Department? @relation(fields: [departmentId], references: [id])
  departmentId Int?

  primaryEmail   Email? @relation("primary", fields: [primaryEmailId], references: [id], onDelete: SetNull)
  primaryEmailId Int?

  primaryPhone   Phone? @relation("primary", fields: [primaryPhoneId], references: [id], onDelete: SetNull)
  primaryPhoneId Int?

  primaryAddress   Address? @relation("primary", fields: [primaryAddressId], references: [id], onDelete: SetNull)
  primaryAddressId Int?

  emails    Email[]   @relation("owner")
  phones    Phone[]   @relation("owner")
  addresses Address[] @relation("owner")

  taxInfo TaxInfo?
}

model Email {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  contactType PersonalOrWork @default(Personal)
  email       String
  notes       String?
  contact     Contact        @relation("owner", fields: [contactId], references: [id])
  contactId   Int
  openTime    Json?          @default("[]")
  contacts    Contact[]      @relation("primary")

  @@unique([contactId, email])
  @@index([email])
  @@index([contactId])
}

model Phone {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  contactType PersonalOrWork @default(Personal)
  phone       String
  notes       String?
  openTime    Json?          @default("[]")
  contact     Contact        @relation("owner", fields: [contactId], references: [id])
  contactId   Int

  contacts Contact[] @relation("primary")

  @@unique([contactId, phone])
  @@index([phone])
  @@index([contactId])
}

model Address {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  contactType PersonalOrWork @default(Personal)
  street      String
  city        String
  notes       String?
  openTime    Json?          @default("[]")

  unit     String?
  province String?
  state    String?
  country  String?
  zip      String?

  contact   Contact @relation("owner", fields: [contactId], references: [id])
  contactId Int

  contacts Contact[] @relation("primary")

  @@index([contactId])
}
